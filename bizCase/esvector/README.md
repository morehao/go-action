# esvector

## 创建索引的 dsl
```
PUT /vector_test
{
  "mappings": {
    "properties": {
      "content": {
        "type": "text"
      },
      "embedding": {
        "type": "dense_vector",
        "dims": 384,
        "index": true,
        "similarity": "cosine"
      }
    }
  }
}
```
vector_test 索引字段说明表:

| 字段名         | 类型             | 说明                                         |
| ----------- | -------------- | ------------------------------------------ |
| `content`   | `text`         | 文本内容字段，支持分词与关键词全文检索（如 BM25）                |
| `embedding` | `dense_vector` | 稠密向量字段，用于语义相似度检索（基于 HNSW 索引），需指定维度和相似度计算方法 |

embedding 字段属性说明:

| 属性名          | 值              | 说明                                    |
| ------------ | -------------- | ------------------------------------- |
| `type`       | `dense_vector` | 表示字段为稠密向量类型，用于向量搜索                    |
| `dims`       | `384`          | 向量维度，应与实际 embedding 模型输出一致            |
| `index`      | `true`         | 表示为该字段构建向量索引，允许在查询中用于向量检索             |
| `similarity` | `cosine`       | 使用 **余弦相似度** 计算向量之间的相似程度，适用于大多数语义匹配场景 |



## 插入数据
通过调用 `127.0.0.1:8888/putVector` 接口，插入数据，返回插入结果

写入操作对应的 DSL：
```
POST /vector_test/_doc
{
	"content": "这是一个用于测试的文本",
	"embedding": [0, 0.001, 0.002, 0.003, 0.004, 0.0050000004, 0.006, 0.007, 0.008, 0.009000001, 0.010000001, 0.011000001, 0.012, 0.013, 0.014, 0.015000001, 0.016, 0.017, 0.018000001, 0.019000001, 0.020000001, 0.021000002, 0.022000002, 0.023000002, 0.024, 0.025, 0.026, 0.027, 0.028, 0.029000001, 0.030000001, 0.031000001, 0.032, 0.033, 0.034, 0.035, 0.036000002, 0.037, 0.038000003, 0.039, 0.040000003, 0.041, 0.042000003, 0.043, 0.044000003, 0.045, 0.046000004, 0.047000002, 0.048, 0.049000002, 0.05, 0.051000003, 0.052, 0.053000003, 0.054, 0.055000003, 0.056, 0.057000004, 0.058000002, 0.059000004, 0.060000002, 0.061000004, 0.062000003, 0.063, 0.064, 0.065000005, 0.066, 0.067, 0.068, 0.069000006, 0.07, 0.071, 0.072000004, 0.07300001, 0.074, 0.075, 0.076000005, 0.07700001, 0.078, 0.079, 0.080000006, 0.081, 0.082, 0.083000004, 0.08400001, 0.085, 0.086, 0.087000005, 0.08800001, 0.089, 0.09, 0.091000006, 0.09200001, 0.093, 0.094000004, 0.095000006, 0.096, 0.097, 0.098000005, 0.09900001, 0.1, 0.101, 0.102000006, 0.10300001, 0.104, 0.105000004, 0.106000006, 0.10700001, 0.108, 0.109000005, 0.11000001, 0.11100001, 0.112, 0.113000005, 0.11400001, 0.115, 0.116000004, 0.117000006, 0.11800001, 0.119, 0.120000005, 0.12100001, 0.12200001, 0.123, 0.124000005, 0.125, 0.126, 0.127, 0.128, 0.12900001, 0.13000001, 0.13100001, 0.132, 0.133, 0.134, 0.135, 0.136, 0.13700001, 0.13800001, 0.13900001, 0.14, 0.141, 0.142, 0.143, 0.14400001, 0.14500001, 0.14600001, 0.147, 0.148, 0.149, 0.15, 0.15100001, 0.15200001, 0.15300001, 0.15400001, 0.155, 0.156, 0.157, 0.158, 0.15900001, 0.16000001, 0.16100001, 0.162, 0.163, 0.164, 0.165, 0.16600001, 0.16700001, 0.16800001, 0.16900001, 0.17, 0.171, 0.172, 0.17300001, 0.17400001, 0.17500001, 0.17600001, 0.177, 0.178, 0.179, 0.18, 0.18100001, 0.18200001, 0.18300001, 0.18400002, 0.185, 0.186, 0.187, 0.18800001, 0.18900001, 0.19000001, 0.19100001, 0.192, 0.193, 0.194, 0.19500001, 0.19600001, 0.19700001, 0.19800001, 0.19900002, 0.2, 0.201, 0.202, 0.20300001, 0.20400001, 0.20500001, 0.20600002, 0.20700002, 0.208, 0.209, 0.21000001, 0.21100001, 0.21200001, 0.21300001, 0.21400002, 0.215, 0.216, 0.21700001, 0.21800001, 0.21900001, 0.22000001, 0.22100002, 0.22200002, 0.223, 0.224, 0.22500001, 0.22600001, 0.22700001, 0.22800002, 0.22900002, 0.23, 0.231, 0.23200001, 0.23300001, 0.23400001, 0.23500001, 0.23600002, 0.23700002, 0.238, 0.23900001, 0.24000001, 0.24100001, 0.24200001, 0.24300002, 0.24400002, 0.245, 0.246, 0.24700001, 0.24800001, 0.24900001, 0.25, 0.25100002, 0.252, 0.25300002, 0.254, 0.25500003, 0.256, 0.257, 0.25800002, 0.259, 0.26000002, 0.261, 0.26200002, 0.263, 0.264, 0.26500002, 0.266, 0.26700002, 0.268, 0.26900002, 0.27, 0.27100003, 0.272, 0.273, 0.27400002, 0.275, 0.27600002, 0.277, 0.27800003, 0.279, 0.28, 0.28100002, 0.282, 0.28300002, 0.284, 0.28500003, 0.286, 0.287, 0.28800002, 0.289, 0.29000002, 0.291, 0.29200003, 0.293, 0.294, 0.29500002, 0.296, 0.29700002, 0.298, 0.29900002, 0.3, 0.30100003, 0.30200002, 0.303, 0.30400002, 0.305, 0.30600002, 0.307, 0.30800003, 0.30900002, 0.31, 0.31100002, 0.312, 0.31300002, 0.314, 0.31500003, 0.316, 0.317, 0.31800002, 0.319, 0.32000002, 0.321, 0.32200003, 0.323, 0.324, 0.32500002, 0.326, 0.32700002, 0.328, 0.32900003, 0.33, 0.33100003, 0.33200002, 0.333, 0.33400002, 0.335, 0.33600003, 0.337, 0.33800003, 0.33900002, 0.34, 0.34100002, 0.342, 0.34300002, 0.344, 0.34500003, 0.34600002, 0.347, 0.34800002, 0.349, 0.35000002, 0.351, 0.35200003, 0.35300002, 0.354, 0.35500002, 0.356, 0.35700002, 0.358, 0.35900003, 0.36, 0.36100003, 0.36200002, 0.363, 0.36400002, 0.365, 0.36600003, 0.367, 0.36800003, 0.36900002, 0.37, 0.37100002, 0.372, 0.37300003, 0.374, 0.37500003, 0.37600002, 0.377, 0.37800002, 0.379, 0.38000003, 0.381, 0.38200003, 0.38300002]
}
```

## 查询向量
通过调用 `127.0.0.1:8888/getVector` 接口，查询向量，返回查询结果

查询对应的 DSL：
```
POST /vector_test/_search
{
	"_source": ["content"],
	"knn": {
		"field": "embedding",
		"query_vector": [0, 0.001, 0.002, 0.003, 0.004, 0.0050000004, 0.006, 0.007, 0.008, 0.009000001, 0.010000001, 0.011000001, 0.012, 0.013, 0.014, 0.015000001, 0.016, 0.017, 0.018000001, 0.019000001, 0.020000001, 0.021000002, 0.022000002, 0.023000002, 0.024, 0.025, 0.026, 0.027, 0.028, 0.029000001, 0.030000001, 0.031000001, 0.032, 0.033, 0.034, 0.035, 0.036000002, 0.037, 0.038000003, 0.039, 0.040000003, 0.041, 0.042000003, 0.043, 0.044000003, 0.045, 0.046000004, 0.047000002, 0.048, 0.049000002, 0.05, 0.051000003, 0.052, 0.053000003, 0.054, 0.055000003, 0.056, 0.057000004, 0.058000002, 0.059000004, 0.060000002, 0.061000004, 0.062000003, 0.063, 0.064, 0.065000005, 0.066, 0.067, 0.068, 0.069000006, 0.07, 0.071, 0.072000004, 0.07300001, 0.074, 0.075, 0.076000005, 0.07700001, 0.078, 0.079, 0.080000006, 0.081, 0.082, 0.083000004, 0.08400001, 0.085, 0.086, 0.087000005, 0.08800001, 0.089, 0.09, 0.091000006, 0.09200001, 0.093, 0.094000004, 0.095000006, 0.096, 0.097, 0.098000005, 0.09900001, 0.1, 0.101, 0.102000006, 0.10300001, 0.104, 0.105000004, 0.106000006, 0.10700001, 0.108, 0.109000005, 0.11000001, 0.11100001, 0.112, 0.113000005, 0.11400001, 0.115, 0.116000004, 0.117000006, 0.11800001, 0.119, 0.120000005, 0.12100001, 0.12200001, 0.123, 0.124000005, 0.125, 0.126, 0.127, 0.128, 0.12900001, 0.13000001, 0.13100001, 0.132, 0.133, 0.134, 0.135, 0.136, 0.13700001, 0.13800001, 0.13900001, 0.14, 0.141, 0.142, 0.143, 0.14400001, 0.14500001, 0.14600001, 0.147, 0.148, 0.149, 0.15, 0.15100001, 0.15200001, 0.15300001, 0.15400001, 0.155, 0.156, 0.157, 0.158, 0.15900001, 0.16000001, 0.16100001, 0.162, 0.163, 0.164, 0.165, 0.16600001, 0.16700001, 0.16800001, 0.16900001, 0.17, 0.171, 0.172, 0.17300001, 0.17400001, 0.17500001, 0.17600001, 0.177, 0.178, 0.179, 0.18, 0.18100001, 0.18200001, 0.18300001, 0.18400002, 0.185, 0.186, 0.187, 0.18800001, 0.18900001, 0.19000001, 0.19100001, 0.192, 0.193, 0.194, 0.19500001, 0.19600001, 0.19700001, 0.19800001, 0.19900002, 0.2, 0.201, 0.202, 0.20300001, 0.20400001, 0.20500001, 0.20600002, 0.20700002, 0.208, 0.209, 0.21000001, 0.21100001, 0.21200001, 0.21300001, 0.21400002, 0.215, 0.216, 0.21700001, 0.21800001, 0.21900001, 0.22000001, 0.22100002, 0.22200002, 0.223, 0.224, 0.22500001, 0.22600001, 0.22700001, 0.22800002, 0.22900002, 0.23, 0.231, 0.23200001, 0.23300001, 0.23400001, 0.23500001, 0.23600002, 0.23700002, 0.238, 0.23900001, 0.24000001, 0.24100001, 0.24200001, 0.24300002, 0.24400002, 0.245, 0.246, 0.24700001, 0.24800001, 0.24900001, 0.25, 0.25100002, 0.252, 0.25300002, 0.254, 0.25500003, 0.256, 0.257, 0.25800002, 0.259, 0.26000002, 0.261, 0.26200002, 0.263, 0.264, 0.26500002, 0.266, 0.26700002, 0.268, 0.26900002, 0.27, 0.27100003, 0.272, 0.273, 0.27400002, 0.275, 0.27600002, 0.277, 0.27800003, 0.279, 0.28, 0.28100002, 0.282, 0.28300002, 0.284, 0.28500003, 0.286, 0.287, 0.28800002, 0.289, 0.29000002, 0.291, 0.29200003, 0.293, 0.294, 0.29500002, 0.296, 0.29700002, 0.298, 0.29900002, 0.3, 0.30100003, 0.30200002, 0.303, 0.30400002, 0.305, 0.30600002, 0.307, 0.30800003, 0.30900002, 0.31, 0.31100002, 0.312, 0.31300002, 0.314, 0.31500003, 0.316, 0.317, 0.31800002, 0.319, 0.32000002, 0.321, 0.32200003, 0.323, 0.324, 0.32500002, 0.326, 0.32700002, 0.328, 0.32900003, 0.33, 0.33100003, 0.33200002, 0.333, 0.33400002, 0.335, 0.33600003, 0.337, 0.33800003, 0.33900002, 0.34, 0.34100002, 0.342, 0.34300002, 0.344, 0.34500003, 0.34600002, 0.347, 0.34800002, 0.349, 0.35000002, 0.351, 0.35200003, 0.35300002, 0.354, 0.35500002, 0.356, 0.35700002, 0.358, 0.35900003, 0.36, 0.36100003, 0.36200002, 0.363, 0.36400002, 0.365, 0.36600003, 0.367, 0.36800003, 0.36900002, 0.37, 0.37100002, 0.372, 0.37300003, 0.374, 0.37500003, 0.37600002, 0.377, 0.37800002, 0.379, 0.38000003, 0.381, 0.38200003, 0.38300002],
		"k": 5,
		"num_candidates": 100
	}
}
```

字段说明如下：

| 字段/参数名               | 类型        | 示例值                    | 说明                                          |
| -------------------- | --------- | ---------------------- | ------------------------------------------- |
| `_source`            | 数组        | `["content"]`          | 控制返回结果中显示哪些字段（只返回 content，不含 embedding 向量）  |
| `knn.field`          | 字符串       | `"embedding"`          | 向量字段名，必须是 `dense_vector` 且已设置 `index: true` |
| `knn.query_vector`   | 数组(float) | `[0.1, 0.2, ..., 0.3]` | 需要检索的查询向量，维度必须等于索引字段的维度（如 384）              |
| `knn.k`              | 整数        | `5`                    | 返回最相似的前 `k` 个文档                             |
| `knn.num_candidates` | 整数        | `100`                  | 在 HNSW 图中考虑的候选节点数，**影响召回率与性能的平衡**           |

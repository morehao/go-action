# å¤–éƒ¨ä¼ å…¥å‚æ•°ï¼ˆåªç”¨äº build å’Œ runï¼‰
DeployMode ?=
DeployVersion ?=

VERSION_PKG = github.com/morehao/go-action/bizCase/gobuild/version

# build å‰å‚æ•°æ ¡éªŒ
check-vars:
ifndef DeployMode
	$(error âŒ deployMode is required. Use: make build deployMode=dev deployVersion=1.0.0)
endif
ifndef DeployVersion
	$(error âŒ deployVersion is required. Use: make build deployMode=dev deployVersion=1.0.0)
endif

# ç¼–è¯‘å¸¦å˜é‡çš„å¯æ‰§è¡Œæ–‡ä»¶
build: check-vars
	@echo "ğŸ”§ Building with:"
	@echo "  - Deploy Mode:     $(DeployMode)"
	@echo "  - Deploy Version:  $(DeployVersion)"
	go build -ldflags "\
		-X '$(VERSION_PKG).DeployMode=$(DeployMode)' \
		-X '$(VERSION_PKG).DeployVersion=$(DeployVersion)'" \
		-o myapp main.go

# ç¼–è¯‘å¹¶è¿è¡Œ
run: build
	@echo "ğŸš€ Running..."
	./myapp
